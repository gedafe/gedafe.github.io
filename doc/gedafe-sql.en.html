<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="en">
<HEAD>
<META name="generator" content="HTML Tidy, see www.w3.org">
<TITLE>Database Manual</TITLE>
<SCRIPT type="text/javascript" language="JavaScript">
<!-- Hiding the code
function nb_imgNormal(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_n.src');
        self.status = '';
    }
}
function nb_imgSelect(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_s.src');
        self.status = '';
    }
}
function nb_imgOver(imgName, nohints, descript) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_o.src');
        if (! nohints) self.status = descript;
    }
}
// done hiding -->
</SCRIPT>

<STYLE type="text/css">
<!--
H1,H2,H3 {color: #4f4f4f}
A {text-decoration: underline;
   color: #f00ca4}
HR, H1, H2, DIV, P, LI,
UL, OL, TABLE, TD, TR {font-family: lucida-sans, helvetica, arial, sans-serif}
PRE {font-family: courier, typewriter, fixed}
H1 {font-size: 18pt }
H2 {font-size: 16pt }
DIV, P, LI,
UL, OL, TABLE, TD, TR {font-size: 12pt }
SMALL {font-size: 10pt}
-->
</STYLE>

<TITLE>gedafe-sql - Database Structure for Gedafe</TITLE>
<LINK rev="made" href="mailto:dws@ee.ethz.ch">
</HEAD>
<BODY bgcolor="#bfbfbf" text="#000000" link="#f00ca4" vlink="#f00ca4" alink="#f00ca4">
<TABLE border="0" bgcolor="#ffffff" cellpadding="0" cellspacing="0" summary="">
<TR>
<TD valign="top">
<TABLE border="0" bgcolor="#ffffff" cellpadding="0" cellspacing="0" summary="">
<TR>
<TD rowspan="5" width="20"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="20" height="1" align="bottom" border="0"></TD>
<TD colspan="4"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="10" align="bottom" border="0"></TD>
</TR>

<TR>
<TD colspan="4" valign="top" align="left"><IMG src="../.pics/logo.png" alt="" width="390" height="70"></TD>
</TR>

<TR>
<TD colspan="4"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="20" align="bottom" border="0"></TD>
</TR>

<TR>
<TD rowspan="2" width="120" valign="top">
<DIV><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="50" align="bottom" border="0"></DIV>

<SCRIPT type="text/javascript" language="JavaScript">
<!-- Hiding the code
if (document.images) {
    nb_img1_about_n = new Image();
    nb_img1_about_n.src = '../.img/about-std.en.gif';
    nb_img1_about_o = new Image();
    nb_img1_about_o.src = '../.img/about-ovr.en.gif';
    nb_img1_doc_n = new Image();
    nb_img1_doc_n.src = '../.img/doc-std.en.gif';
    nb_img1_doc_o = new Image();
    nb_img1_doc_o.src = '../.img/doc-ovr.en.gif';
    nb_img1_screenshots_n = new Image();
    nb_img1_screenshots_n.src = '../.img/screenshots-std.en.gif';
    nb_img1_screenshots_o = new Image();
    nb_img1_screenshots_o.src = '../.img/screenshots-ovr.en.gif';
    nb_img1_download_n = new Image();
    nb_img1_download_n.src = '../.img/download-std.en.gif';
    nb_img1_download_o = new Image();
    nb_img1_download_o.src = '../.img/download-ovr.en.gif';
    nb_img1_people_n = new Image();
    nb_img1_people_n.src = '../.img/people-std.en.gif';
    nb_img1_people_o = new Image();
    nb_img1_people_o.src = '../.img/people-ovr.en.gif';
    nb_img1_mailinglist_n = new Image();
    nb_img1_mailinglist_n.src = '../.img/mailinglist-std.en.gif';
    nb_img1_mailinglist_o = new Image();
    nb_img1_mailinglist_o.src = '../.img/mailinglist-ovr.en.gif';
}
// done hiding -->
</SCRIPT>

 

<DIV><A href="../index.en.html" onmouseover="nb_imgOver('nb_img1_about', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_about'); return true" onfocus="nb_imgOver('nb_img1_about', 0, ''); return true" onblur="nb_imgNormal('nb_img1_about'); return true"><IMG name="nb_img1_about" src="../.img/about-std.en.gif" alt="About" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../doc/index.en.html" onmouseover="nb_imgOver('nb_img1_doc', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc'); return true" onfocus="nb_imgOver('nb_img1_doc', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc'); return true"><IMG name="nb_img1_doc" src="../.img/doc-std.en.gif" alt="Documentation" border="0" width="120" height="25"></A></DIV>

<SCRIPT type="text/javascript" language="JavaScript">
<!-- Hiding the code
if (document.images) {
    nb_img1_doc_frontend_n = new Image();
    nb_img1_doc_frontend_n.src = '../.img/doc_frontend-std.en.gif';
    nb_img1_doc_frontend_o = new Image();
    nb_img1_doc_frontend_o.src = '../.img/doc_frontend-ovr.en.gif';
    nb_img1_doc_pearls_n = new Image();
    nb_img1_doc_pearls_n.src = '../.img/doc_pearls-std.en.gif';
    nb_img1_doc_pearls_o = new Image();
    nb_img1_doc_pearls_o.src = '../.img/doc_pearls-ovr.en.gif';
    nb_img1_doc_pearlreports_n = new Image();
    nb_img1_doc_pearlreports_n.src = '../.img/doc_pearlreports-std.en.gif';
    nb_img1_doc_pearlreports_o = new Image();
    nb_img1_doc_pearlreports_o.src = '../.img/doc_pearlreports-ovr.en.gif';
    nb_img1_doc_cpptemplate_n = new Image();
    nb_img1_doc_cpptemplate_n.src = '../.img/doc_cpptemplate-std.en.gif';
    nb_img1_doc_cpptemplate_o = new Image();
    nb_img1_doc_cpptemplate_o.src = '../.img/doc_cpptemplate-ovr.en.gif';
}
// done hiding -->
</SCRIPT>

 

<DIV><A href="../doc/gedafe-user.en.html" onmouseover="nb_imgOver('nb_img1_doc_frontend', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_frontend'); return true" onfocus="nb_imgOver('nb_img1_doc_frontend', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_frontend'); return true"><IMG name="nb_img1_doc_frontend" src="../.img/doc_frontend-std.en.gif" alt="..Frontend" border="0" width="120" height="20"></A></DIV>

<DIV><IMG src="../.img/doc_database-sel.en.gif" alt="..Database" width="120" height="20"></DIV>

<DIV><A href="../doc/gedafe-pearls.en.html" onmouseover="nb_imgOver('nb_img1_doc_pearls', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_pearls'); return true" onfocus="nb_imgOver('nb_img1_doc_pearls', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_pearls'); return true"><IMG name="nb_img1_doc_pearls" src="../.img/doc_pearls-std.en.gif" alt="..Gedafe Pearls" border="0" width="120" height="20"></A></DIV>

<DIV><A href="../doc/pearlreports.en.html" onmouseover="nb_imgOver('nb_img1_doc_pearlreports', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_pearlreports'); return true" onfocus="nb_imgOver('nb_img1_doc_pearlreports', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_pearlreports'); return true"><IMG name="nb_img1_doc_pearlreports" src="../.img/doc_pearlreports-std.en.gif" alt="..PearlReports" border="0" width="120" height="20"></A></DIV>

<DIV><A href="../doc/CPPTemplate.en.html" onmouseover="nb_imgOver('nb_img1_doc_cpptemplate', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_cpptemplate'); return true" onfocus="nb_imgOver('nb_img1_doc_cpptemplate', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_cpptemplate'); return true"><IMG name="nb_img1_doc_cpptemplate" src="../.img/doc_cpptemplate-std.en.gif" alt="..CPPTemplate" border="0" width="120" height="20"></A></DIV>

<DIV><A href="../screenshots.en.html" onmouseover="nb_imgOver('nb_img1_screenshots', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_screenshots'); return true" onfocus="nb_imgOver('nb_img1_screenshots', 0, ''); return true" onblur="nb_imgNormal('nb_img1_screenshots'); return true"><IMG name="nb_img1_screenshots" src="../.img/screenshots-std.en.gif" alt="Screenshots" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../download.en.html" onmouseover="nb_imgOver('nb_img1_download', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_download'); return true" onfocus="nb_imgOver('nb_img1_download', 0, ''); return true" onblur="nb_imgNormal('nb_img1_download'); return true"><IMG name="nb_img1_download" src="../.img/download-std.en.gif" alt="Download" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../people.en.html" onmouseover="nb_imgOver('nb_img1_people', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_people'); return true" onfocus="nb_imgOver('nb_img1_people', 0, ''); return true" onblur="nb_imgNormal('nb_img1_people'); return true"><IMG name="nb_img1_people" src="../.img/people-std.en.gif" alt="People" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../mailinglist.en.html" onmouseover="nb_imgOver('nb_img1_mailinglist', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_mailinglist'); return true" onfocus="nb_imgOver('nb_img1_mailinglist', 0, ''); return true" onblur="nb_imgNormal('nb_img1_mailinglist'); return true"><IMG name="nb_img1_mailinglist" src="../.img/mailinglist-std.en.gif" alt="Mailing List" border="0" width="120" height="25"></A></DIV>

<DIV><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="60" align="bottom" border="0"></DIV>

<DIV><SMALL>Page Maintainer:<BR>
 <IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="10" height="1" align="bottom" border="0"><A href="mailto:tobi@oetiker.ch">Tobias Oetiker</A></SMALL></DIV>

<DIV><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="10" align="bottom" border="0"><BR>
 <SMALL>Last Update:<BR>
<IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="10" height="1" align="bottom" border="0">2003-09-29</SMALL></DIV>
</TD>
<TD rowspan="2" width="30"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="30" height="1" align="bottom" border="0"></TD>
<TD valign="top">
<DIV><IMG src="../.img/Database_Manual_H1.en.gif" alt="Database Manual" width="500" height="50"></DIV>

<P><A name="__index__"></A></P>

<!-- INDEX BEGIN -->
<UL>
<LI><A href="#name">NAME</A></LI>

<LI><A href="#synopsis">SYNOPSIS</A></LI>

<LI><A href="#naming_rules">NAMING RULES</A></LI>

<LI style="list-style: none">
<UL>
<LI><A href="#unique_field_names">Unique Field Names</A></LI>

<LI><A href="#non_speaking_unique_id">Non Speaking Unique ID</A></LI>
</UL>
</LI>

<LI><A href="#views_for_presentation">VIEWS FOR PRESENTATION</A></LI>

<LI style="list-style: none">
<UL>
<LI><A href="#presentation_view">Presentation View</A></LI>

<LI><A href="#edit_link_to_referenced_row">Edit link to referenced row</A></LI>

<LI><A href="#the_combobox">The Combo-box</A></LI>
</UL>
</LI>

<LI><A href="#meta_information">META INFORMATION</A></LI>

<LI style="list-style: none">
<UL>
<LI><A href="#the_meta_tables_table">The <STRONG>meta_tables</STRONG> Table</A></LI>

<LI><A href="#the_meta_fields_table">The <STRONG>meta_fields</STRONG> table</A></LI>
</UL>
</LI>

<LI><A href="#edit_widgets">EDIT WIDGETS</A></LI>

<LI><A href="#reports">REPORTS</A></LI>

<LI><A href="#access_rights">ACCESS RIGHTS</A></LI>

<LI><A href="#binary_large_objects">BINARY LARGE OBJECTS</A></LI>

<LI><A href="#copyright">COPYRIGHT</A></LI>

<LI><A href="#license">LICENSE</A></LI>

<LI><A href="#author">AUTHOR</A></LI>
</UL>

<!-- INDEX END -->
<HR>
<H1><A name="name">NAME</A></H1>

<P>gedafe-sql - Database Structure for Gedafe</P>

<HR>
<H1><A name="synopsis">SYNOPSIS</A></H1>

<P>Gedafe is a generic web front-end to PostgreSQL. Generic means in this context that Gedafe does not know anything about the structure or contents of the database it is presenting.</P>

<P>The idea is that Gedafe looks at a database and presents it on the web. Because Gedafe is no AI it relies on certain rules for the database structure and naming rules.</P>

<P>It is also important to note that Gedafe itself does not impose any restrictions on to what a user can do with a database. All consistency and permission rules must be checked on the back-end side of the database. PostgreSQL offers excellent support for this kind of checks through referential integrity constraints, rules, triggers and stored procedures. The advantage of this approach is that data integrity does not depend on the usage of a certain front-end, but is enforced for all possible interactions with the database short of manipulation of the database structure and rules themselves. The disadvantage of this approach is that it imposes a large load on the database server, especially on insert and update queries.</P>

<HR>
<H1><A name="naming_rules">NAMING RULES</A></H1>

<H2><A name="unique_field_names">Unique Field Names</A></H2>

<P>Each field in the user defined tables must have a unique name. This simplifies writing queries because there is no need for fully qualified field naming. The unique names must be built by appending the field name to the table name with an underscore in between.</P>

<P>It is allowed to omit the <EM>table</EM><STRONG>-</STRONG> for non ID fields, but you may not begin a column name with the reserved prefixes <STRONG>gedafe_</STRONG> or <STRONG>meta_</STRONG>. Also the column names <EM>table</EM><STRONG>_id</STRONG> and <EM>table</EM><STRONG>_hid</STRONG> are reserved to ID fields (see below).</P>

<P>Example:</P>

<PRE>
 CREATE TABLE customer (
   customer_name    TEXT,
   customer_age     INT,
   customer_address TEXT,
   timestamp        TIMESTAMP DEFAULT now(),  -- lax naming ok here
   meta_customer    integer     -- WRONG, "meta_*" is reserved
 );
</PRE>

<P>Using the table name + underscore prefix is nevertheless regarded ``good practice''.</P>

<H2><A name="non_speaking_unique_id">Non Speaking Unique ID</A></H2>

<P>Each table defines a <STRONG>unique</STRONG>, <STRONG>non speaking</STRONG>, <STRONG>numeric</STRONG> <EM>table</EM><STRONG>_id</STRONG> field. It is best to use an auto-increment counter for this field. The field <EM>table</EM><STRONG>_id</STRONG> can be used when a table is referenced from another table.</P>

<P>If a unique ID for human consumption is required, it must be called <EM>table</EM><STRONG>_hid</STRONG>.</P>

<P>Often the <EM>table</EM><STRONG>_hid</STRONG> will be presented to the user of the database, while internally the <EM>table</EM><STRONG>_id</STRONG> is used as reference.</P>

<P>Example:</P>

<PRE>
 CREATE TABLE customer (
   customer_id SERIAL NOT NULL PRIMARY KEY,
   customer_hid TEXT UNIQUE,
   customer_name TEXT,
   customer_age INT,
   customer_address TEXT,
   timestamp        TIMESTAMP DEFAULT now(),  -- lax naming ok here
 )
</PRE>

<P>The reason we are requiering unique nonspeaking ids is twofold. First gedafe need some way to uniquely identify each database record (*_list, *_combo, ...) and second it is good design practice to use nonspeaking keys. In any event, if you need speaking keys, just use a *_hid on top of the *_id, and you are all set.</P>

<P>You will also note, that we are imposing some magic names, like *_list, *_combo, *_id, *_hid, ... we chose todo this, because we think it is simpler to name fields apropriately, than to write up another table telling gedafe about which field has what role in the database.</P>

<PRE>
=head2 Table and Field Naming
</PRE>

<P>For the benefit of a friendly presentation, each field and table in the database can have a description. Descriptions are added using the <STRONG>COMMENT</STRONG> command.</P>

<P>Example:</P>

<PRE>
 COMMENT ON TABLE customer IS 'Customers';
 COMMENT ON COLUMN customer.customer_hid 'C Number';
</PRE>

<HR>
<H1><A name="views_for_presentation">VIEWS FOR PRESENTATION</A></H1>

<H2><A name="presentation_view">Presentation View</A></H2>

<P>When listing the contents of a table, the front-end uses ``<CODE>SELECT * FROM</CODE> <EM>table</EM>'' unless there is a view called <EM>table</EM><CODE>_list</CODE> in which case the records are pulled from this view. The reason for this is that tables containing references to tuples from other tables might not be very presentable. The users don't want to see <STRONG>*_id</STRONG> fields. They want the corresponding <STRONG>*_HID</STRONG> field from the referenced table or maybe even more. Another reason for creating a <STRONG>*_list</STRONG> view may be that you do not want to present ALL records or fields to a user.</P>

<P>The first column of a <STRONG>*_list</STRONG> view must always be the <STRONG>*_id</STRONG> field from original table. This column does not get displayed if there is a <STRONG>*_hid</STRONG> column as well. The other column names should match their original counter part unless they contain calculated data (this is not enforced; however, no new comments for the fields of the view must be given if this convention is followed as described below).</P>

<P>Example:</P>

<PRE>
 CREATE VIEW absence_list AS
   SELECT absence_id, pers_hid, absty_hid, absence_start,
          absence_end, absence_days, absence_desc
   FROM absence,absty,pers
   WHERE absence_pers=pers_id
         AND absence_absty=absty_id
         AND NOT pers_virt;
</PRE>

<P>A <STRONG>*_list</STRONG> view can contain rows which do not correspond to rows in the original table. These rows must have the value <STRONG>NULL</STRONG> in the <STRONG>*_id</STRONG> column. 'Editing' the data of such a row from the front-end causes a row to be inserted into the database. Defaults for the new row are taken from the edited NULL-row.</P>

<P>You may want to pre-sort the contents of a view. Unfortunately, PostgreSQL does not allow to ORDER views. As a work-around, you can create a column in your view called <STRONG>meta_sort</STRONG> which the front-end will use to sort the contents of the view as long as there are no other sorting instructions present.</P>

<P>You can set a COMMENT for each field of a <STRONG>*_list</STRONG> view, this comment will then be taken as column head. If you do not define a special comment, but the name of the list field is identical to the field in its parent table, then the COMMENT from the parent table field will be used. The same is true if the list field name matches the name of any other commented table field in the database.</P>

<H2><A name="edit_link_to_referenced_row">Edit link to referenced row</A></H2>

<PRE>
  IF
    a column in some tableX references another tableY
  AND
    a column in tableX_list has the same name as the
    referencing colum in tableX
  THEN
    Gedafe will make the text of the value of that
    field in tableX_list a  link to the edit form for
    the referenced row in tableY.
</PRE>

<P>E.G.: given this definition for the orders_list view:</P>

<PRE>
  SELECT orders_id, orders_date, customer_name AS orders_customer,
  orders_qty, product_hid, product_description, orders_shipped,
  ((customer_name || ','::text) || (product_hid)::text)
  AS meta_sort FROM orders, customer, product
  WHERE ((customer_id = orders.orders_customer)
  AND (product_id = orders_product));
</PRE>

<PRE>
  [orders table]
  ID Date       Customer Quantity HID Description       Shipped
  1  2003-10-21 freek    2        tmp Temporary Product yes
  
In this case the customer "freek" will be a link to the edit form for
customer freek.
</PRE>

<P>Note the customer_name as orders_customer and the customer_id = orders.orders_customer in the select.</P>

<P>All links are subject to ACL settings. No read and write: no edit link.</P>

<H2><A name="the_combobox">The Combo-box</A></H2>

<P>When editing fields that are a reference to a row in another table it is useful to have some help in filling out the field. Best is to provide a list of all possible values. The widget used to present this information to the user is called combo-box. In order to make this possible, each table which gets referenced by another table must be accompanied by a special view called <EM>table</EM><STRONG>*_combo</STRONG>. This view must have two columns one called <STRONG>id</STRONG> and one called <STRONG>text</STRONG>. The <STRONG>id</STRONG> column contains the id of the referenced record. You can select the view to be taken for a certain field instead of the one chosen automatically be Gedafe by explicitely using the 'idcombo', 'hidcombo' or 'combo' widget attribute in meta_fields like explained in <A href="#edit_widgets">EDIT WIDGETS</A>.</P>

<P>If you want to order the contents of the combo-box, then this can be done using an extra <STRONG>meta_sort</STRONG> column as explained below. By default, combo-boxes get sorted by the contents of their <STRONG>text</STRONG> column.</P>

<P>Example:</P>

<PRE>
 CREATE VIEW gender_combo AS
    SELECT gender_hid  AS id,
           gender_name AS text
    FROM gender;
</PRE>

<PRE>
 CREATE VIEW proj_combo AS
    SELECT proj_id                               AS id,
           proj_name || ', ' || pers_hid         AS text,
           proj_popularity(proj_id) || proj_name AS meta_sort
    FROM proj, pers
    WHERE proj_pers=pers_id and proj_active=true;
</PRE>

<P>The last example uses a custom function <CODE>proj_popularity()</CODE> which calculates a project popularity value which is then used as sort key in order to get the most popular projects first in the combo box. Again, this is not computationally cheap.</P>

<HR>
<H1><A name="meta_information">META INFORMATION</A></H1>

<H2><A name="the_meta_tables_table">The <STRONG>meta_tables</STRONG> Table</A></H2>

<P>For some tables you may want to provide additional information to optimize their presentation in the front-end.</P>

<PRE>
 CREATE TABLE meta_tables (
    -- Table Name
    meta_tables_table       NAME NOT NULL PRIMARY KEY,
    -- Attribute
    meta_tables_attribute   TEXT NOT NULL,
    -- Value
    meta_tables_value       TEXT
 );
</PRE>

<P>This additional information is specified for a given table in attribute/value pairs. The <STRONG>meta_tables</STRONG> table must be created in your database, even if you don't use it. The following attributes are currently defined:</P>

<DL>
<DT><STRONG><A name="item_filterfirst">filterfirst</A></STRONG><BR>
</DT>

<DD>If a table tends to be big, it is possible to suggest a field to filter on before a table is displayed. This is done by specifying the field name as value for this attribute. If you have a _list view for that long table, the filterfirst must be set on the _list table and one of its attributes. Because views will not contain any information about which table a certain attribute potentially references, this information must be specified in the meta_fields table accordingly.</DD>

<DD>
<P>Example:</P>
</DD>

<DD>
<P>I have this view called task_list which I want to filterfirst on the pack_id attribut. The combo I want to see comes from the pack table.</P>
</DD>

<DD>
<PRE>
 INSERT INTO meta_tables VALUES (DEFAULT,'task_list', 'filterfirst','my_pack');
 INSERT INTO meta_fields VALUES (DEFAULT,'task_list', 'my_pack','reference','pack');
</PRE>
</DD>

<DD>
<P>Note, that if pack had a _hid attribute, gedafe would figure it out and use this instead of the standard _id, assuming you would prefer _hid over _id.</P>
</DD>

<DT><STRONG><A name="item_hide">hide</A></STRONG><BR>
</DT>

<DD>If the value of this attribute is set to '1', the table won't be shown by the front-end.</DD>

<DT><STRONG><A name="item_showref">showref</A></STRONG><BR>
</DT>

<DD>Show references from another table to this table. The value is just the name of the referencing table (or a comma separated list of referencing tables. no spaces allowed).</DD>

<DD>
<P>if meta_tables contains a row that reads:</P>
</DD>

<DD>
<PRE>
  'table1','showref','some_other_table_that_has_foreign_keys_for_table1'
</PRE>
</DD>

<DD>
<P>E.G.:</P>
</DD>

<DD>
<PRE>
  'products','showref','orders'
</PRE>
</DD>

<DD>
<P>it will add a column to the listing of table1 (products) that tells you how many orders reference that product.</P>
</DD>

<DD>
<PRE>
  You would get something like this:
  
  HID Description         WWW-URL            orders
  tmp Temporary product   <A href="http://tmp.org/">http://tmp.org/</A>    2 items
</PRE>
</DD>

<DD>
<P>The ``2 items'' value is also a link that will take you to the order table with searchfields set such that only the orders that reference this product will be shown. The creation of this table will of cource be subject to your privileges regarding reading from the other table. In case the reference is directed to the same table, or two columns of the second table reference the first table, you need to explicitly tell gedafe, which is the referencing column.</P>
</DD>

<DD>
<P>In the above example you would insert this line in meta_tables: 'products','showref','orders(orders_product)'</P>
</DD>

<DT><STRONG><A name="item_twocols">twocols</A></STRONG><BR>
</DT>

<DD>If this attribute is defined, it tells gedafe that wou want a 2 columns layout in your data add and edit screens for this table. The value should be 1 then. Gedafe then hands over an Attribute ``TWOCOL'' to the template editfield.html and toggles its value between 0 or 1 between 2 fields. So the template knows if a field is to be positioned left or right in a two column layout. The template has to evaluate this Attribute, look after the ``editfield.html'' example template.</DD>

<DT><STRONG><A name="item_longcomment">longcomment</A></STRONG><BR>
</DT>

<DD>A long comment for a table. Will be printed in the Main menu screen, in the table header and pop up as tool tip when you place the mouse over the table links on top of each table. There is such a comment for the Customer table in the demo1.sql example database.</DD>

<DT><STRONG><A name="item_editmask">editmask</A></STRONG><BR>
</DT>

<DD>You can supply a template for the edit/add screen. If this value is defined, it is the filename of a template for the edit/add screen of this table and must be found in the templates directory. This template is a normal html snippet (without &lt;html&gt; and &lt;body&gt; tags!). It is placed verbatim between Edit/Add Header and Edit/Add Footer.</DD>

<DD>
<P>To make it work, for every field place ##XXXX_LABEL## at the places you want the field description and ##XXXX_INPUT## at the place you want the Input widget to be in your html layout. A very ugly example ``customer'' template is supplied for the ``customer'' table.</P>
</DD>

<DT><STRONG><A name="item_quicklink">quicklink</A></STRONG><BR>
</DT>

<DD>A quicklink is shown at the botton of a list screen. You can offer links to different gedafe databases, external sources of information, gedafe pearls, gedafe onions, online help or whatever external web site.</DD>

<DD>
<P>A quicklink is defined as a URL, a optional icon and a description text.</P>
</DD>

<DD>
<P>As you can define 9 quicklink per Table, the attribute is <A href="#item_quicklink"><CODE>quicklink(1)</CODE></A> to <A href="#item_quicklink"><CODE>quicklink(9)</CODE></A> respectivly. The value is of the form:</P>
</DD>

<DD>
<P>foot(``http://example'',``/img/icon.gif'',``Example Quicklink'');</P>
</DD>

<DD>
<P>A empty icon is coded as a <EM>``''</EM> empty string.</P>
</DD>
</DL>

<H2><A name="the_meta_fields_table">The <STRONG>meta_fields</STRONG> table</A></H2>

<P>For most fields is is possible to determine a presentation mode from the data type of the field. For some fields this is not possible and additional information must be provided. This is done through the <STRONG>meta_fields</STRONG> table. Every database must have a <STRONG>meta_fields</STRONG> table. It may be empty if no special information must be provided.</P>

<PRE>
 CREATE TABLE meta_fields (
    -- Table Name
    meta_fields_table       NAME    NOT NULL,
    -- Field Name
    meta_fields_field       NAME    NOT NULL,
    -- Attribute
    meta_fields_attribute   TEXT    NOT NULL,
    -- Value
    meta_fields_value       TEXT
 );
</PRE>

<P>As for meta_tables, the additional information is specified in attribute/value pairs for the field in question. The following attributes are defined:</P>

<DL>
<DT><STRONG><A name="item_align">align</A></STRONG><BR>
</DT>

<DD>In listings of table content, this field overrides the alignment of the column. The contents of this field is put directly in the alignment section of the &lt;td&gt; tag. It is therefor good practice to put double quotes around left,right and center. e.g.: ``LEFT'' ``RIGHT'' ``CENTER''.</DD>

<DD>
<P>When not specified the alignment defaults to ``LEFT'' unless the column type is in [numeric,date,time,timestamp,int4,int8,float8]. In that case, the alignment is ``RIGHT'' NOWRAP.</P>
</DD>

<DD>
<PRE>
=item copy
</PRE>
</DD>

<DD>
<P>If set to '1', while adding entries to a table, the data for this field will be copied from one form to the next.</P>
</DD>

<DT><STRONG><A name="item_hide_list">hide_list</A></STRONG><BR>
</DT>

<DD>Do not show this field in the list (table) view.</DD>

<DT><STRONG><A name="item_markup">markup</A></STRONG><BR>
</DT>

<DD>If set to '1', the data in this field will be scanned for strings which resemble special web objects (currently implemented: e-mail addresses and http URLs). If found, these strings will be replaced with appropriate HTML markup (template variable DATA will be altered in element 'td').</DD>

<DT><STRONG><A name="item_bgcolor_field">bgcolor_field</A></STRONG><BR>
</DT>

<DD>Control the line background colour in list views. One column of the view is abused as html colour name like <CODE>#ffeeaa</CODE> or <CODE>red</CODE>.</DD>

<DD>
<P>Select this abused column by setting the list view column attribute <A href="#item_bgcolor_field"><CODE>bgcolor_field</CODE></A> to 1 for this colour column. This column is not displayed.</P>
</DD>

<DD>
<P>Instead you can just name this view column <CODE>meta_bgcolour</CODE>.</P>
</DD>

<DD>
<P>Nice for calenders (to show kind of weekday), to do lists (to show priority), bug list, etc.</P>
</DD>

<DD>
<P>If you want to give only one table column a different markup, you can produce the html that is needed for that with a SQL expression like this: '&lt;div bgcolour=' || CASE WHEN urgent 'style=``color:red; font-weight:bold''' ELSE 'style=``color:green'''|| '&gt;'|| date || '&lt;/div&gt;' (be urgent a boolean column). Ugly, but it works.</P>
</DD>

<DT><STRONG><A name="item_sortfunc">sortfunc</A></STRONG><BR>
</DT>

<DD>If you have a column which contains names like 'von Burg' or 'di Alfredi' and you want the column sorted by the second word, you can create a function which converts the name into a string suitable for sorting. The name of this function must be given as value for this attribute. Note, however, that there is a heavy performance penalty, as this function must be called for each row of the table. A less costly approach during selects is the use of a meta_sort field as described above (the penalty there is again in inserts and updates).</DD>

<DT><STRONG><A name="item_order">order</A></STRONG><BR>
</DT>

<DD>Change the order of the fields in the edit screen. Gedafe reads the order of the fields from the table definition and assignes a ordering value to each field. The first field gets 1 the second 2 and so on. This value can be overriden with the 'order' attribute. Use floating values to move your fields around without having to change everything. Note that the *_id field is normally first and does not show up in edit view anyway, take this into account when counting.</DD>

<DT><STRONG><A name="item_desc">desc</A></STRONG><BR>
</DT>

<DD>The labels in table headers and edit forms are normally pulled from whatever you set with the COMMENT command. You can override this with the 'desc' setting.</DD>

<DT><STRONG><A name="item_widget">widget</A></STRONG><BR>
</DT>

<DD>Override Gedafe's automatically selected widget (element in the edit form to enter the value of a field). A widget definition is written like this:</DD>

<DD>
<PRE>
 widgetname(param1=val1,param2=val2,...)
</PRE>
</DD>

<DD>
<P>If no parameters are specified, then the parens can be omitted. See chapter <A href="#edit_widgets">EDIT WIDGETS</A> for a description of all available widgets and the available parameters.</P>
</DD>
</DL>

<HR>
<H1><A name="edit_widgets">EDIT WIDGETS</A></H1>

<DL>
<DT><STRONG><A name="item_readonly">readonly</A></STRONG><BR>
</DT>

<DD>read-only text</DD>

<DT><STRONG><A name="item_text">text</A></STRONG><BR>
</DT>

<DD>Text field. The optional argument <EM>size</EM> specifies the width of the text field in characters (default: 20).</DD>

<DT><STRONG><A name="item_format_number_2c_format_date_2c_format_timestamp">format_number, format_date, format_timestamp</A></STRONG><BR>
</DT>

<DD>Formatted text input. The mandatory argument <EM>template</EM> specifies how the string should be converted from/to the number/date/timestamp. The corresponding PostgreSQL <STRONG>to_char</STRONG>, <STRONG>to_number</STRONG>, or <STRONG>to_timestamp</STRONG> function will be used with the given <EM>template</EM>.</DD>

<DD>
<P>Example: format_date(template=Mon DD YYYY)</P>
</DD>

<DT><STRONG><A name="item_area">area</A></STRONG><BR>
</DT>

<DD>Use a <CODE>TEXTAREA</CODE> widget for this field, such that longer amounts of text can be entered. The optional <EM>rows</EM> and <EM>cols</EM> parameters (default 4x60) specify number of rows and columns for the textarea field.</DD>

<DT><STRONG><A name="item_date">date</A></STRONG><BR>
</DT>

<DD>The <EM>date</EM> widget on date columns generates a pulldown list to enter dates. The <EM>from</EM> and <EM>to</EM> parameters specify the the range for the year list.</DD>

<DT><STRONG><A name="item_idcombo">idcombo</A></STRONG><BR>
</DT>

<DD>Text-entry, followed by a combo-box to select (text-entry has higher priority). The mandatory parameter <EM>combo</EM> specifies the name of the view to use to fetch the contents of the combo-box. See <A href="#the_combobox">The Combo-box</A> for a description of how to write views for combo-boxes.</DD>

<DT><STRONG><A name="item_hidcombo">hidcombo</A></STRONG><BR>
</DT>

<DD>Like <A href="#item_idcombo"><CODE>idcombo</CODE></A>, but the text field references the <CODE>hid</CODE> in the referenced table. Additionally to <EM>combo</EM>, the mandatory parameter <EM>ref</EM> specifies the name of the referenced table (so that the <CODE>hid</CODE> can be converted to <CODE>id</CODE>).</DD>

<DT><STRONG><A name="item_combo">combo</A></STRONG><BR>
</DT>

<DD>Like <A href="#item_idcombo"><CODE>idcombo</CODE></A> but just the combo-box without text entry.</DD>

<DT><STRONG><A name="item_radio">radio</A></STRONG><BR>
</DT>

<DD>Like <A href="#item_idcombo"><CODE>idcombo</CODE></A>, but the values are presented as Radio Buttons. The optional parameter <EM>shownull</EM> adds a button for the <EM>NULL</EM> value, the optional parameter <EM>nulltext</EM> defines the label next to the <EM>INULL</EM> button.</DD>

<DD>
<P>Fixme: This widget should switch automatically to a combo box if there are more options then a configurable threshold.</P>
</DD>

<DT><STRONG><A name="item_isearch">isearch</A></STRONG><BR>
</DT>

<DD><EM>isearch</EM> as a widget for a column that references another table specifies a interactive record selecting applet. The applet is designed to replace comboboxes on tables with many records where the combobox would become impracticaly large.</DD>

<DD>
<P>Because the isearch applet searches in all columns of the referenced table it ignores the table*_combo views, instead it use the original table or ,if present, the table*_list view. Also note that the values of bytea columns are translated to yield only the filename instead of the raw content.</P>
</DD>

<DD>
<P>The isearch applet will only download a search resultset that is smaller than 20kb to make sure that long waits are avoided. The progress of the download is displayed with a blue bar progress indicator. When the resultset is too large the user has the option to narrow down the search criteria by entering more characters to column search values and then rescanning the resultspace by pressing the the 'scan' button. Once a resultset is loaded entering characters to column search values immeadiately (interactivly) selects matching records.</P>
</DD>

<DD>
<P>Please also note that for this applet to work you need to have a browser that supports java, javascript and liveconnect. (Mozilla, Netscape and IE will do fine)</P>
</DD>

<DD>
<P>The isearch applet can be placed on a custom location on your web-server. Placing it in the cgi-bin directory of your server can lead to the web-server trying to execute the java archive instead of serving it. Make sure that the 'isearch' variable in your cgi-script is set to point to the web address of the isearch.jar java archive.</P>
</DD>

<DT><STRONG><A name="item_file2fs">file2fs</A></STRONG><BR>
</DT>

<DD>If you want to handle big files with your gedafe frontend and you do not want to store them in the database but rather in external file, this widget is for you. It presents a file-upload box in the browser and stores the uploaded file on the machine where your gedafe frontend is running.</DD>

<DD>
<P>To make this work you have to Sepcify the root directory for your uploads in the gedafe.cgi with the <EM>file2fs_dir</EM> property.</P>
</DD>

<DD>
<P>The <EM>files2fs</EM> widget supports the optional <EM>uploadpath</EM> property which allows you to specify a subdirectory below <EM>file2fs_dir</EM> which the uploaded file will be stored.</P>
</DD>

<DD>
<PRE>
 file2fs(uploadpath=budgets)
</PRE>
</DD>

<DD>
<P>Gedafe will make sure your upload will not overwrite any other file present in the directory. The stored filename will be relative to <EM>file2fs_dir</EM> so that files will still be found even when you modify the <EM>uploadpath</EM>.</P>
</DD>

<DD>
<P>If you upload a new file and there is already one noted in the database, the old file will be removed.</P>
</DD>

<DT><STRONG><A name="item_mncombo"><CODE>mncombo(mntable=publauthors[,combo=publauthors_combo])</CODE></A></STRONG><BR>
</DT>

<DD>If you have two tables with an m:n relationship,</DD>

<DD>
<PRE>
  --------------  M                    N  --------
 | publications | ---------------------- | author |
  --------------                          --------
 (publication_id)                       (author_id)
</PRE>
</DD>

<DD>
<P>this is normally implemented in sql databases by creating a third table that holds the mn information, potentially with added meta information.</P>
</DD>

<DD>
<PRE>
  -------------  1  M  ------------  N  1  --------
 | publication | ---- | publauthor | ---- | author |
  -------------        ------------        --------
 (publication_id)  (publication,author)  (author_id)
</PRE>
</DD>

<DD>
<P>by default, gedafe would require you to edit the publauthor table seperately, entering all the valid publication/author combinations. This is not very user friendly. This is where mncombo comes in. Mncombo is a 'virtual widget' it can display the information of the mn-table in either the left or the right side table. This would enable you to select a list of author when entering a new publication. The mncombo widget would display two lists, one with all the authors and the other one with the authors you have selected for the particular publication.</P>
</DD>

<DD>
<P>The implementation of mncombo supports an optional sorting field so that the authors in our example can not only be asigned to a publication but also sorted.</P>
</DD>

<DD>
<P>The structure of the publauthor table must be:</P>
</DD>

<DD>
<PRE>
  publauthor_id          SERIAL NOT NULL PRIMARY KEY,
  publauthor_publication INT NOT NULL REFERENCES publication ON DELETE CASCADE,
  publauthor_author      INT NOT NULL REFERENCE author,
  publauthor_order       INT NOT NULL DEFAULT 0 -- optional,
  UNIQUE(publauthor_publication,publauthor_author),
</PRE>
</DD>

<DD>
<P>Note the <STRONG>ON DELETE CASCADE</STRONG> bit, it makes sure all the entries in the publauthor table refering to a publication that gets deleted are removed along with it. Without this setting, you would first have to remove all the authors from virtual combo before you could remove a publication. By NOT putting the same CASCADE on the _author field, we can ensure that no author gets removed from the database as long as he is listed as the author of a publication.</P>
</DD>

<DD>
<P>To tell gedafe about the virtual publication_authors field (represented by the mncombo widget) you would add the following to the meta_fields table:</P>
</DD>

<DD>
<PRE>
 INSERT INTO meta_fields VALUES(
   'publication', 'publication_authors',
   'widget', 'mncombo(mntable=publauthors)'
 )
</PRE>
</DD>

<DD>
<P>You may not want the publauthor table to show up directly in the UI:</P>
</DD>

<DD>
<PRE>
 INSERT INTO meta_tables VALUES(
   'publauthor','hide','1'
 )
</PRE>
</DD>

<DD>
<P>Gedafe has to know how to present the list of authors in the interface so you have to create an <STRONG>author_combo</STRONG> view. If you want to use another view you can specify this via the optional combo argument of the mncombo widget.</P>
</DD>

<DD>
<P>To specify the position of the virtual publication_authors field in the publication form use:</P>
</DD>

<DD>
<PRE>
 INSERT INTO meta_fields VALUES (
   'publication','publication_authors','order','3'
 )
</PRE>
</DD>

<DD>
<P>You may also want to specify a friendly label for the virtual field:</P>
</DD>

<DD>
<PRE>
 INSERT INTO meta_fields VALUES (
   'publication','publication_authors','desc','Authors'
 )
</PRE>
</DD>

<DD>
<P>Note, that it is possible to use mncombo even in self-referencing setups. The problem is that in this setup an mn-table can encode even the direction of the relation ship. Person A can be owe person B as well as person B can owe person A and it is not the same thing. So while both id columns of the mn-table reference the same table, it is important to know which is which.</P>
</DD>

<DD>
<P>Normally it is enough for gedafe to look at the table a column references to figure out the setup. In the selfreferencing case the nameing of the columns will be taken into account too. The rule is to use the column whoes name ends in <STRONG>_${TABLE}</STRONG> as the left hand column.</P>
</DD>

<DD>
<P>The mncombo widget is implemented using the javascript in mncombo_javascript.html this gets loaded via the ##HEAD_SCRIPT## element in the header.html template.</P>
</DD>
</DL>

<HR>
<H1><A name="reports">REPORTS</A></H1>

<P>Analog to the <STRONG>*_list</STRONG> views you can create as many <STRONG>*_rep</STRONG> views as you want, the only condition being that their names end in <STRONG>_rep</STRONG>. This can be used for simple reporting. For more complex reports you may want to check out our <STRONG>PearlReports</STRONG> module.</P>

<P>Example:</P>

<PRE>
 CREATE VIEW absence_rep AS
    SELECT to_char(absence_start,'YYYY') as year,
           pers_hid, absty_hid, sum(absence_days) as days
    FROM absence, pers, absty
    WHERE absence_pers=pers_id
          AND absence_absty=absty_id AND NOT pers_virt
    GROUP BY pers_hid, absty_hid, year;
</PRE>

<HR>
<H1><A name="access_rights">ACCESS RIGHTS</A></H1>

<P>Gedafe reads the access rights of the user to determine if a table can be accessed (SELECT must be granted), if a record can be added (INSERT must be granted) and if a record can be edited/deleted (UPDATE must be granted). Be careful about access rights in the database. They determine what users can do. To manage access rights more easily, it is sensible to grant rights to groups and add users to the groups according to the rights you want them to have.</P>

<HR>
<H1><A name="binary_large_objects">BINARY LARGE OBJECTS</A></H1>

<P>Columns of the BYTEA type get a special treatment in Gedafe. These columns are used to store files in the database. Users can upload and download the file with their browser. To use these files in other software please keep in mind that the perl BYTEA encoding is not standard. The directory src/bytea provides information for using this data with Perl and PHP.</P>

<HR>
<H1><A name="copyright">COPYRIGHT</A></H1>

<P>Copyright (c) 2000-2003 ETH Zurich, All rights reserved.</P>

<HR>
<H1><A name="license">LICENSE</A></H1>

<P>This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; either version 2.1 of the License, or (at your option) any later version.</P>

<P>This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</P>

<P>You should have received a copy of the GNU Lesser General Public License along with this library; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</P>

<HR>
<H1><A name="author">AUTHOR</A></H1>

<P>Tobias&nbsp;Oetiker&nbsp;&lt;tobi@oetiker.ch&gt;, David&nbsp;Schweikert&nbsp;&lt;david_at_schweikert.ch&gt;, Fritz&nbsp;Zaucker&nbsp;&lt;fritz@zaucker.ch&gt;, Adi&nbsp;Fairbank&nbsp;&lt;adi@adiraj.org&gt;, Freek&nbsp;Zindel&nbsp;&lt;freek@zindel.nl&gt;</P>

&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD rowspan="2" widht="0"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="0" height="1" align="bottom" border="0"></TD>
</TR>

<TR>
<TD><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="20" align="bottom" border="0"></TD>
</TR>
</TABLE>
</TD>
<TD valign="TOP" align="RIGHT"><IMG src="../.img/database_manual_Decor.en.gif" alt="" width="100" height="600"></TD>
</TR>
</TABLE>
</BODY>
</HTML>

