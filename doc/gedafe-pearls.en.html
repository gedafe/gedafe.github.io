<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="en">
<HEAD>
<META name="generator" content="HTML Tidy, see www.w3.org">
<TITLE>Gedafe Pearl Reports</TITLE>
<SCRIPT type="text/javascript" language="JavaScript">
<!-- Hiding the code
function nb_imgNormal(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_n.src');
        self.status = '';
    }
}
function nb_imgSelect(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_s.src');
        self.status = '';
    }
}
function nb_imgOver(imgName, nohints, descript) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_o.src');
        if (! nohints) self.status = descript;
    }
}
// done hiding -->
</SCRIPT>

<STYLE type="text/css">
<!--
H1,H2,H3 {color: #4f4f4f}
A {text-decoration: underline;
   color: #f00ca4}
HR, H1, H2, DIV, P, LI,
UL, OL, TABLE, TD, TR {font-family: lucida-sans, helvetica, arial, sans-serif}
PRE {font-family: courier, typewriter, fixed}
H1 {font-size: 18pt }
H2 {font-size: 16pt }
DIV, P, LI,
UL, OL, TABLE, TD, TR {font-size: 12pt }
SMALL {font-size: 10pt}
-->
</STYLE>

<TITLE>gedafe-pearls - Multilevel Reports for Gedafe</TITLE>
<LINK rev="made" href="mailto:dws@ee.ethz.ch">
</HEAD>
<BODY bgcolor="#bfbfbf" text="#000000" link="#f00ca4" vlink="#f00ca4" alink="#f00ca4">
<TABLE border="0" bgcolor="#ffffff" cellpadding="0" cellspacing="0" summary="">
<TR>
<TD valign="top">
<TABLE border="0" bgcolor="#ffffff" cellpadding="0" cellspacing="0" summary="">
<TR>
<TD rowspan="5" width="20"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="20" height="1" align="bottom" border="0"></TD>
<TD colspan="4"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="10" align="bottom" border="0"></TD>
</TR>

<TR>
<TD colspan="4" valign="top" align="left"><IMG src="../.pics/logo.png" alt="" width="390" height="70"></TD>
</TR>

<TR>
<TD colspan="4"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="20" align="bottom" border="0"></TD>
</TR>

<TR>
<TD rowspan="2" width="120" valign="top">
<DIV><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="50" align="bottom" border="0"></DIV>

<SCRIPT type="text/javascript" language="JavaScript">
<!-- Hiding the code
if (document.images) {
    nb_img1_about_n = new Image();
    nb_img1_about_n.src = '../.img/about-std.en.gif';
    nb_img1_about_o = new Image();
    nb_img1_about_o.src = '../.img/about-ovr.en.gif';
    nb_img1_doc_n = new Image();
    nb_img1_doc_n.src = '../.img/doc-std.en.gif';
    nb_img1_doc_o = new Image();
    nb_img1_doc_o.src = '../.img/doc-ovr.en.gif';
    nb_img1_screenshots_n = new Image();
    nb_img1_screenshots_n.src = '../.img/screenshots-std.en.gif';
    nb_img1_screenshots_o = new Image();
    nb_img1_screenshots_o.src = '../.img/screenshots-ovr.en.gif';
    nb_img1_download_n = new Image();
    nb_img1_download_n.src = '../.img/download-std.en.gif';
    nb_img1_download_o = new Image();
    nb_img1_download_o.src = '../.img/download-ovr.en.gif';
    nb_img1_people_n = new Image();
    nb_img1_people_n.src = '../.img/people-std.en.gif';
    nb_img1_people_o = new Image();
    nb_img1_people_o.src = '../.img/people-ovr.en.gif';
    nb_img1_mailinglist_n = new Image();
    nb_img1_mailinglist_n.src = '../.img/mailinglist-std.en.gif';
    nb_img1_mailinglist_o = new Image();
    nb_img1_mailinglist_o.src = '../.img/mailinglist-ovr.en.gif';
}
// done hiding -->
</SCRIPT>

 

<DIV><A href="../index.en.html" onmouseover="nb_imgOver('nb_img1_about', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_about'); return true" onfocus="nb_imgOver('nb_img1_about', 0, ''); return true" onblur="nb_imgNormal('nb_img1_about'); return true"><IMG name="nb_img1_about" src="../.img/about-std.en.gif" alt="About" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../doc/index.en.html" onmouseover="nb_imgOver('nb_img1_doc', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc'); return true" onfocus="nb_imgOver('nb_img1_doc', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc'); return true"><IMG name="nb_img1_doc" src="../.img/doc-std.en.gif" alt="Documentation" border="0" width="120" height="25"></A></DIV>

<SCRIPT type="text/javascript" language="JavaScript">
<!-- Hiding the code
if (document.images) {
    nb_img1_doc_frontend_n = new Image();
    nb_img1_doc_frontend_n.src = '../.img/doc_frontend-std.en.gif';
    nb_img1_doc_frontend_o = new Image();
    nb_img1_doc_frontend_o.src = '../.img/doc_frontend-ovr.en.gif';
    nb_img1_doc_database_n = new Image();
    nb_img1_doc_database_n.src = '../.img/doc_database-std.en.gif';
    nb_img1_doc_database_o = new Image();
    nb_img1_doc_database_o.src = '../.img/doc_database-ovr.en.gif';
    nb_img1_doc_pearlreports_n = new Image();
    nb_img1_doc_pearlreports_n.src = '../.img/doc_pearlreports-std.en.gif';
    nb_img1_doc_pearlreports_o = new Image();
    nb_img1_doc_pearlreports_o.src = '../.img/doc_pearlreports-ovr.en.gif';
    nb_img1_doc_cpptemplate_n = new Image();
    nb_img1_doc_cpptemplate_n.src = '../.img/doc_cpptemplate-std.en.gif';
    nb_img1_doc_cpptemplate_o = new Image();
    nb_img1_doc_cpptemplate_o.src = '../.img/doc_cpptemplate-ovr.en.gif';
}
// done hiding -->
</SCRIPT>

 

<DIV><A href="../doc/gedafe-user.en.html" onmouseover="nb_imgOver('nb_img1_doc_frontend', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_frontend'); return true" onfocus="nb_imgOver('nb_img1_doc_frontend', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_frontend'); return true"><IMG name="nb_img1_doc_frontend" src="../.img/doc_frontend-std.en.gif" alt="..Frontend" border="0" width="120" height="20"></A></DIV>

<DIV><A href="../doc/gedafe-sql.en.html" onmouseover="nb_imgOver('nb_img1_doc_database', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_database'); return true" onfocus="nb_imgOver('nb_img1_doc_database', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_database'); return true"><IMG name="nb_img1_doc_database" src="../.img/doc_database-std.en.gif" alt="..Database" border="0" width="120" height="20"></A></DIV>

<DIV><IMG src="../.img/doc_pearls-sel.en.gif" alt="..Gedafe Pearls" width="120" height="20"></DIV>

<DIV><A href="../doc/pearlreports.en.html" onmouseover="nb_imgOver('nb_img1_doc_pearlreports', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_pearlreports'); return true" onfocus="nb_imgOver('nb_img1_doc_pearlreports', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_pearlreports'); return true"><IMG name="nb_img1_doc_pearlreports" src="../.img/doc_pearlreports-std.en.gif" alt="..PearlReports" border="0" width="120" height="20"></A></DIV>

<DIV><A href="../doc/CPPTemplate.en.html" onmouseover="nb_imgOver('nb_img1_doc_cpptemplate', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_doc_cpptemplate'); return true" onfocus="nb_imgOver('nb_img1_doc_cpptemplate', 0, ''); return true" onblur="nb_imgNormal('nb_img1_doc_cpptemplate'); return true"><IMG name="nb_img1_doc_cpptemplate" src="../.img/doc_cpptemplate-std.en.gif" alt="..CPPTemplate" border="0" width="120" height="20"></A></DIV>

<DIV><A href="../screenshots.en.html" onmouseover="nb_imgOver('nb_img1_screenshots', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_screenshots'); return true" onfocus="nb_imgOver('nb_img1_screenshots', 0, ''); return true" onblur="nb_imgNormal('nb_img1_screenshots'); return true"><IMG name="nb_img1_screenshots" src="../.img/screenshots-std.en.gif" alt="Screenshots" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../download.en.html" onmouseover="nb_imgOver('nb_img1_download', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_download'); return true" onfocus="nb_imgOver('nb_img1_download', 0, ''); return true" onblur="nb_imgNormal('nb_img1_download'); return true"><IMG name="nb_img1_download" src="../.img/download-std.en.gif" alt="Download" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../people.en.html" onmouseover="nb_imgOver('nb_img1_people', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_people'); return true" onfocus="nb_imgOver('nb_img1_people', 0, ''); return true" onblur="nb_imgNormal('nb_img1_people'); return true"><IMG name="nb_img1_people" src="../.img/people-std.en.gif" alt="People" border="0" width="120" height="25"></A></DIV>

<DIV><A href="../mailinglist.en.html" onmouseover="nb_imgOver('nb_img1_mailinglist', 0, ''); return true" onmouseout="nb_imgNormal('nb_img1_mailinglist'); return true" onfocus="nb_imgOver('nb_img1_mailinglist', 0, ''); return true" onblur="nb_imgNormal('nb_img1_mailinglist'); return true"><IMG name="nb_img1_mailinglist" src="../.img/mailinglist-std.en.gif" alt="Mailing List" border="0" width="120" height="25"></A></DIV>

<DIV><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="60" align="bottom" border="0"></DIV>

<DIV><SMALL>Page Maintainer:<BR>
 <IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="10" height="1" align="bottom" border="0"><a href="http://tobi.oetiker.ch/">Tobias Oetiker</A></SMALL></DIV>

<DIV><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="10" align="bottom" border="0"><BR>
 <SMALL>Last Update:<BR>
<IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="10" height="1" align="bottom" border="0">2003-09-27</SMALL></DIV>
</TD>
<TD rowspan="2" width="30"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="30" height="1" align="bottom" border="0"></TD>
<TD valign="top">
<DIV><IMG src="../.img/Gedafe_Pearl_Reports_H1.en.gif" alt="Gedafe Pearl Reports" width="500" height="50"></DIV>

<P><A name="__index__"></A></P>

<!-- INDEX BEGIN -->
<UL>
<LI><A href="#name">NAME</A></LI>

<LI><A href="#description">DESCRIPTION</A></LI>

<LI><A href="#usage">USAGE</A></LI>

<LI><A href="#example">EXAMPLE</A></LI>

<LI><A href="#see_also">SEE ALSO</A></LI>

<LI><A href="#copyright">COPYRIGHT</A></LI>

<LI><A href="#license">LICENSE</A></LI>

<LI><A href="#author">AUTHOR</A></LI>
</UL>

<!-- INDEX END -->
<HR>
<H1><A name="name">NAME</A></H1>

<P>gedafe-pearls - Multilevel Reports for Gedafe</P>

<HR>
<H1><A name="description">DESCRIPTION</A></H1>

<P>With a more or less complex select statement you can get about any data you want from the database. Gedafe allows you to present the result of such queries through the <EM>*_rep</EM> views which are presented on the entry screen.</P>

<P>What if you want to show a report listing all your customers, with their orders, grouped by date. A query will quickly return the relevant data, but the customer will be repeated over and over again in many records, also you might not want to show orders from ages back, but only orders from the last month, so prior to makeing the report you would want to specify a begin and end date. This is where Gedafe Pearls come in.</P>

<P>Pearls are object oriented perl modules sitting in sepcial directory. Each module has to offer a set of methodes which will be used from within Gedafe. First to list the Pearl in the entry screen, then to produce a custom form to let the user customize the report (eg select the date range). And finally a methode to create the actual report.</P>

<PRE>
  ------------------------------------
 | Custome Report                     |
 | --------------                     |
 |                                    |
 | 2 - Peter David                    |
 |                                    |
 |     Orders from: 2002-12-01        |
 |         1 Red Flower               |
 |        12 Bottles of Wather        |
 |                                    |
 |     Orders from: 2003-08-14        |
 |         3 Green Software Packages  |
 |                                    |
 | 8 - John Miller                    |
 |                                    |
 |     Orders from: 2001-09-29        |
 |        18 Candles                  |
 |                                    |
  ------------------------------------
   
For creating the report you can use the included PearlReports module which
makes the creation of multilevel reports very simple. Check the separate documentation.
</PRE>

<HR>
<H1><A name="usage">USAGE</A></H1>

<P>First you have to tell Gedafe that it should go looking for Pearls. This is done by placing the line</P>

<PRE>
 pearl_dir      =&gt; '/path/to/pearls',
</PRE>

<P>into the Start command of your Gedafe CGI. Then you have to write a Pearl and store it in <EM>/path/to/pearls</EM>. When you restart gedafe it will go looking there and integrate all Pearls it finds in its Entry screen.</P>

<P>Pearls are object oriented Perl modles which inherit from <EM>Gedafe::Pearl</EM>. A Pearl has to override the following methodes:</P>

<DL>
<DT><STRONG><A name="item_info">info</A></STRONG><BR>
</DT>

<DD>Returns two values. The name of the Pearl and a short description of the Pearl.</DD>

<DT><STRONG><A name="item_template">template</A></STRONG><BR>
</DT>

<DD>Returns a pointer to a list of lists. It is used to build a form which is presented to the user to setup the report. Each element of the list is a list with the following elements: <STRONG>name</STRONG>, <STRONG>label</STRONG>, <STRONG>widget</STRONG>, <STRONG>default value</STRONG>, <STRONG>test regexp</STRONG>. The <STRONG>widgets</STRONG> are normal gedafe widgets as you would use in a meta table.</DD>

<DT><STRONG><A name="item_run">run</A></STRONG><BR>
</DT>

<DD>Returns two values. The first value is the content type, the second is the data to be returned to the user.</DD>

<DD>
<P>The run methodes has access to the open database handle as well as to the data entered in the form generated with the template method.</P>
</DD>
</DL>

<P>See the example below for details.</P>

<HR>
<H1><A name="example">EXAMPLE</A></H1>

<P>Commented example Pearl.</P>

<PRE>
 package demo;
</PRE>

<PRE>
 use strict;
 use Gedafe::Pearl qw(format_desc date_print);
 use vars qw(@ISA);
 @ISA = qw(Gedafe::Pearl);
</PRE>

<PRE>
 use DBIx::PearlReports;
</PRE>

<PRE>
 sub new($;@){
     my $proto = shift;
     my $class = ref($proto) || $proto;
     my $self = $class-&gt;SUPER::new(@_);
     return $self;
 }
</PRE>

<PRE>
 sub info($){
    return "Customers Orders","List all Orders of a particular customer";
 }
</PRE>

<PRE>
 sub template ($){
    return [['start', 'Start Date (YYYY-MM-DD)', 'text',
              date_print('month_first'),'\d+-\d+-\d+'],
            ['end', 'End Date (YYYY-MM-DD)', 'text',
              date_print('month_last'),'\d+-\d+-\d+' ],
            ['customer', 'Customer', 'idcombo(combo=customer_combo)','','\d+' ],
           ];
 }
</PRE>

<PRE>
 sub run ($$){
    my $self = shift;
    my $s = shift;
    $self-&gt;SUPER::run($s);
    my $p = $self-&gt;{param};
    my $rep = DBIx::PearlReports::new
       (
        -handle =&gt; $s-&gt;{dbh},
        -query =&gt; &lt;&lt;SQL,
</PRE>

<PRE>
 SELECT customer_id,customer_name,
        order_id,order_date,order_qty,
        product_hid,product_description
 FROM customer,order,product
 WHERE order_product=product_id
      AND customer_id = ?
      AND order_customer = customer_id
      AND order_date &gt;= ?
      AND order_date &lt;= ?
 ORDER BY customer_id,order_date,order_id
</PRE>

<PRE>
 SQL
        -param =&gt; [ $p-&gt;{customer},$p-&gt;{start},$p-&gt;{end}]
</PRE>

<PRE>
       );
</PRE>

<PRE>
 $rep-&gt;group
  ( -trigger =&gt; sub { $field{customer_id} },
    -head =&gt; sub { "Report for $field{customer_id} - $field{customer_name}\n".
                   "Date: $p-&gt;{start} - $p-&gt;{end}\n".
                   "-------------------------------------------------------------\n"},
    -foot =&gt; sub { "Total Items Shipped :".rpcnt($field{product_id})."\n" }
  );
</PRE>

<PRE>
 $rep-&gt;group
  ( -trigger =&gt; sub { $field{order_date} },
     -head =&gt; sub { Orders for $field{order_date}\n"}
  );
</PRE>

<PRE>
 $rep-&gt;body
    ( -contents =&gt; sub {
         sprintf "  %10d %7d %8s  %s\n",
            $field{order_id},
            $field{order_qty},
            $field{product_hid},
            $field{product_desc} } );
</PRE>

<PRE>
   return 'text/plain',
       join '', (map { defined $_ ? $_ : '' } $rep-&gt;makereport);
 }
</PRE>

<PRE>
 1;
</PRE>

<PRE>
<BR>


</PRE>

<H1><A name="see_also">SEE ALSO</A></H1>

<PRE>
<BR>
<EM>gedafe-sql.pod</EM>, <EM>gedafe-templates.txt</EM>, <EM>Text::CPPTemplate</EM>, <EM>gedafe-pearls.pod</EM>,
<EM>DBIx::PearlReports</EM>
<BR>


</PRE>

<H1><A name="copyright">COPYRIGHT</A></H1>

<PRE>
<BR>
Copyright (c) 2000-2003 ETH Zurich, All rights reserved.
<BR>


</PRE>

<H1><A name="license">LICENSE</A></H1>

<PRE>
<BR>
This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.
<BR>
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.
<BR>
You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
<BR>


</PRE>

<H1><A name="author">AUTHOR</A></H1>

<PRE>
<BR>
Tobias Oetiker &lt;tobi@oetiker.ch&gt;
</PRE>

&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</TD>
<TD rowspan="2" widht="0"><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="0" height="1" align="bottom" border="0"></TD>
</TR>

<TR>
<TD><IMG src=".img/imgdot-1x1-transp-ffffff.gif" alt="" width="1" height="20" align="bottom" border="0"></TD>
</TR>
</TABLE>
</TD>
<TD valign="TOP" align="RIGHT"><IMG src="../.img/gedafe_pearl_reports_Decor.en.gif" alt="" width="100" height="600"></TD>
</TR>
</TABLE>
</BODY>
</HTML>

